<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>French Learning ‚Äî Words</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="./css/styles.css"/>

  <style>
    /* quick page-specific styling */
    .set-btn, .section-btn { min-width: 110px; }
    .set-btn.active, .section-btn.active { box-shadow: 0 0 0 .2rem rgba(13,110,253,.25); }
    .word-row { display:flex; align-items:center; gap:.75rem; padding:.5rem .75rem; border-radius:.5rem; }
    .word-row:nth-child(odd) { background:#f8f9fa; }
    .speak { border:none; background:none; padding:0; text-decoration:underline; cursor:pointer; }
    .speak .icon { margin-left:.25rem; opacity:.7; }
    .arrow { font-weight:700; }
    .sticky-img { border:2px dashed #dc3545; border-radius:.5rem; }
  </style>
</head>

<body>
  <!-- Navigation Bar-->
  <div class="container">
    <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
      <a href="./index.html" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
        <img src="images/French_Logo.jpg" alt="French Learning">
      </a>
      <ul class="nav nav-pills">
        <li class="nav-item"><a href="./index.html" class="nav-link text-body-secondary">Home</a></li>
        <li class="nav-item"><a href="./words.html" class="nav-link active bg-dark" aria-current="page">Words</a></li>
        <li class="nav-item"><a href="./training.html" class="nav-link text-body-secondary">Training</a></li>
        <li class="nav-item"><a href="./specials.html" class="nav-link text-body-secondary">Specials</a></li>
        <li class="nav-item"><a href="./media.html" class="nav-link text-body-secondary">Media</a></li>
        <li class="nav-item"><a href="./contact.html" class="nav-link text-body-secondary">Contact</a></li>
        <li class="nav-item"><a href="./team.html" class="nav-link text-body-secondary">Team</a></li>
      </ul>
    </header>
  </div>

  <!-- Header + your sketch -->
  <div class="container mb-4">
    <div class="row g-4 align-items-center">
      <div class="col-lg-6">
        <h1 class="display-6 fw-bold">Word Sets & Sections</h1>
        <p class="lead mb-0">Tap a <strong>French word</strong> to hear its pronunciation. Use the buttons to switch between <em>Sets</em> and <em>Sections</em>.</p>
      </div>
    </div>
  </div>

  <!-- Sets -->
  <div class="container">
    <div class="mb-2 small text-muted">Choose a set:</div>
    <div id="setBar" class="btn-group mb-4 flex-wrap" role="group" aria-label="Sets"></div>

    <!-- Sections -->
    <div class="mb-2 small text-muted">Choose a section:</div>
    <div id="sectionBar" class="btn-group mb-4 flex-wrap" role="group" aria-label="Sections"></div>

    <!-- Word list -->
    <div class="card shadow-sm">
      <div class="card-header bg-light fw-semibold">Words</div>
      <div id="wordList" class="list-group list-group-flush p-3"></div>
    </div>
  </div>

  <!-- Footer -->
  <div class="container">
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
      <p class="col-md-4 mb-0 text-body-secondary">¬© 2025 French Learning Website</p>
      <p class="col-md-4 mb-0 text-body-secondary">Designed and Developed by Vishal Reddy</p>
    </footer>
  </div>

  <script>
    // ----- Data (edit/expand freely) -----
    const DATA = {
      "Set 1": {
        "Section 1": [
          ["bonjour", "hello"],
          ["merci", "thank you"],
          ["s‚Äôil vous pla√Æt", "please"]
        ],
        "Section 2": [
          ["au revoir", "goodbye"],
          ["pardon", "sorry / excuse me"],
          ["bien", "well / good"]
        ],
        "Section 3": [
          ["comment √ßa va ?", "how are you?"],
          ["√ßa va", "I‚Äôm fine"],
          ["oui / non", "yes / no"]
        ]
      },
      "Set 2": {
        "Section 1": [
          ["un", "one"], ["deux", "two"], ["trois", "three"]
        ],
        "Section 2": [
          ["le matin", "morning"], ["l‚Äôapr√®s-midi", "afternoon"], ["le soir", "evening"]
        ],
        "Section 3": [
          ["aujourd‚Äôhui", "today"], ["demain", "tomorrow"], ["hier", "yesterday"]
        ]
      },
      "Set 3": {
        "Section 1": [
          ["le pain", "bread"], ["l‚Äôeau", "water"], ["le caf√©", "coffee"]
        ],
        "Section 2": [
          ["la pomme", "apple"], ["la banane", "banana"], ["l‚Äôorange", "orange"]
        ],
        "Section 3": [
          ["le lait", "milk"], ["le fromage", "cheese"], ["le sucre", "sugar"]
        ]
      }
    };

    // ----- State -----
    const setBar = document.getElementById("setBar");
    const sectionBar = document.getElementById("sectionBar");
    const wordList = document.getElementById("wordList");

    const savedSet = localStorage.getItem("currentSet") || "Set 1";
    const savedSection = localStorage.getItem("currentSection") || "Section 1";
    let currentSet = DATA[savedSet] ? savedSet : Object.keys(DATA)[0];
    let currentSection = (DATA[currentSet] && DATA[currentSet][savedSection]) ? savedSection : Object.keys(DATA[currentSet])[0];

    // ----- Render helpers -----
    function renderSets() {
      setBar.innerHTML = "";
      Object.keys(DATA).forEach(setName => {
        const btn = document.createElement("button");
        btn.className = `btn btn-outline-primary set-btn ${setName === currentSet ? "active" : ""}`;
        btn.textContent = setName.toUpperCase();
        btn.onclick = () => {
          currentSet = setName;
          currentSection = Object.keys(DATA[currentSet])[0];
          localStorage.setItem("currentSet", currentSet);
          localStorage.setItem("currentSection", currentSection);
          renderSets();
          renderSections();
          renderWords();
        };
        setBar.appendChild(btn);
      });
    }

    function renderSections() {
      sectionBar.innerHTML = "";
      Object.keys(DATA[currentSet]).forEach(secName => {
        const btn = document.createElement("button");
        btn.className = `btn btn-outline-secondary section-btn ${secName === currentSection ? "active" : ""}`;
        btn.textContent = secName.toLowerCase();
        btn.onclick = () => {
          currentSection = secName;
          localStorage.setItem("currentSection", currentSection);
          renderSections();
          renderWords();
        };
        sectionBar.appendChild(btn);
      });
    }

    function renderWords() {
      wordList.innerHTML = "";
      const pairs = DATA[currentSet][currentSection];

      pairs.forEach((pair, idx) => {
        const [fr, en] = pair;

        const row = document.createElement("div");
        row.className = "word-row";

        // number
        const num = document.createElement("div");
        num.className = "text-muted";
        num.style.width = "2ch";
        num.textContent = (idx + 1) + ".";
        row.appendChild(num);

        // French (click to speak)
        const frBtn = document.createElement("button");
        frBtn.className = "speak";
        frBtn.type = "button";
        frBtn.dataset.text = fr;
        frBtn.innerHTML = `${fr} <span class="icon">üîä</span>`;
        frBtn.addEventListener("click", () => playFrench(fr, row, frBtn));
        row.appendChild(frBtn);

        // arrow
        const arrow = document.createElement("div");
        arrow.className = "arrow";
        arrow.textContent = "‚Üí";
        row.appendChild(arrow);

        // English
        const enSpan = document.createElement("div");
        enSpan.textContent = en;
        row.appendChild(enSpan);

        wordList.appendChild(row);
      });
    }

    

    // ====== Free TTS via Google Translate + caching + UI state ======
const TTS_BASE = "https://translate.google.com/translate_tts";
const TTS_LANG = "fr";              // French
const TTS_CLIENT = "tw-ob";         // public client used by Translate
const MAX_CHARS = 180;              // stay well under the ~200 char limit

let currentAudio = null;
let currentRow = null;
let currentBtn = null;
const audioCache = new Map();       // text -> objectURL

// Normalize curly quotes/accents & collapse whitespace for consistent cache keys
function normalizeKey(s) {
  return s
    .replaceAll("\u2019", "'")          // curly apostrophe -> straight
    .replaceAll("\u00A0", " ")          // non-breaking space -> space
    .replaceAll(/\s+/g, " ")            // collapse spaces
    .trim();
}

// Simple debounce to avoid spamming the endpoint
let tapLock = false;
function debounceTap(ms = 250) {
  if (tapLock) return true;
  tapLock = true;
  setTimeout(() => (tapLock = false), ms);
  return false;
}

function setPlayingUI(row, btn, isPlaying) {
  if (!row || !btn) return;
  row.classList.toggle("is-playing", isPlaying);
  btn.setAttribute("aria-pressed", String(isPlaying));
  // swap the little icon (üîä -> ‚è∏Ô∏è while playing)
  const icon = btn.querySelector(".icon");
  if (icon) icon.textContent = isPlaying ? "‚è∏Ô∏è" : "üîä";
}

function stopCurrent() {
  if (currentAudio) {
    currentAudio.pause();
    currentAudio.currentTime = 0;
    currentAudio = null;
  }
  setPlayingUI(currentRow, currentBtn, false);
  currentRow = null;
  currentBtn = null;
}

// Chunk text if somehow longer (keeps endpoint happy). For single words this won‚Äôt trigger.
function chunkText(text, maxLen = MAX_CHARS) {
  if (text.length <= maxLen) return [text];
  const parts = [];
  let start = 0;
  while (start < text.length) {
    parts.push(text.slice(start, start + maxLen));
    start += maxLen;
  }
  return parts;
}

async function fetchTTSBlob(text) {
  const url = `${TTS_BASE}?ie=UTF-8&client=${encodeURIComponent(TTS_CLIENT)}&tl=${encodeURIComponent(TTS_LANG)}&q=${encodeURIComponent(text)}`;
  const res = await fetch(url, { mode: "cors" });
  if (!res.ok) throw new Error("TTS HTTP " + res.status);
  return await res.blob();
}

async function getAudioURLFor(text) {
  const key = normalizeKey(text);
  if (audioCache.has(key)) return audioCache.get(key);

  // For long strings, stitch multiple blobs (rare for your use-case, but safe)
  const chunks = chunkText(key);
  if (chunks.length === 1) {
    const blob = await fetchTTSBlob(chunks[0]);
    const url = URL.createObjectURL(blob);
    audioCache.set(key, url);
    return url;
  } else {
    // Concatenate sequentially by playing back-to-back (no single URL). Return a marker.
    return { sequenced: chunks };
  }
}

function playSequentially(parts, row, btn) {
  // Play multiple short clips one after another (edge case).
  let index = 0;
  const playNext = () => {
    if (index >= parts.length) {
      stopCurrent();
      return;
    }
    fetchTTSBlob(parts[index++])
      .then(blob => {
        const url = URL.createObjectURL(blob);
        const audio = new Audio(url);
        currentAudio = audio;
        audio.onended = playNext;
        audio.onerror = () => stopCurrent();
        audio.play().catch(stopCurrent);
      })
      .catch(stopCurrent);
  };
  playNext();
}

function tryWebSpeechFallback(text) {
  if (!("speechSynthesis" in window)) return;
  const utter = new SpeechSynthesisUtterance(text);
  const fr = speechSynthesis.getVoices().find(v => /fr(-|_|$)/i.test(v.lang));
  if (fr) utter.voice = fr;
  utter.lang = (fr && fr.lang) || "fr-FR";
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

async function playFrench(text, row, btn) {
  if (debounceTap()) return; // ignore rapid double taps

  try {
    // Stop anything currently playing
    stopCurrent();

    currentRow = row;
    currentBtn = btn;
    setPlayingUI(currentRow, currentBtn, true);

    const audioURL = await getAudioURLFor(text);

    if (typeof audioURL === "string") {
      const audio = new Audio(audioURL);
      currentAudio = audio;
      audio.onended = () => stopCurrent();
      audio.onerror = () => {
        stopCurrent();
        tryWebSpeechFallback(text); // graceful fallback
      };
      await audio.play();
    } else if (audioURL && audioURL.sequenced) {
      playSequentially(audioURL.sequenced, row, btn);
    } else {
      // Unexpected ‚Äî just fallback
      stopCurrent();
      tryWebSpeechFallback(text);
    }
  } catch (err) {
    console.warn("TTS error:", err);
    stopCurrent();
    tryWebSpeechFallback(text);
  }
}


    

    // ----- Init -----
    renderSets();
    renderSections();
    renderWords();
  </script>
</body>
</html>
